# VMC006 - AI ê¸°ë°˜ ì‚¬ì£¼ ë¶„ì„ ì„œë¹„ìŠ¤

> Google Gemini AIë¥¼ í™œìš©í•œ ì‹¤ì‹œê°„ ì‚¬ì£¼íŒ”ì ë¶„ì„ í”Œë«í¼

VMC006ì€ ìµœì‹  AI ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìƒë…„ì›”ì¼ê³¼ ì¶œìƒì‹œê°„ì„ ë°”íƒ•ìœ¼ë¡œ ì‚¬ì£¼ë¥¼ ë¶„ì„í•˜ê³  ìƒì„¸í•œ ìš´ì„¸ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ë¬´ë£Œë¡œ 3íšŒì˜ ê²€ì‚¬ë¥¼ ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, Pro ìš”ê¸ˆì œë¥¼ êµ¬ë…í•˜ë©´ ë§¤ì›” 10íšŒì˜ ê³ ê¸‰ AI ëª¨ë¸ì„ ì‚¬ìš©í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [ì‹œì‘í•˜ê¸°](#-ì‹œì‘í•˜ê¸°)
- [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#-í™˜ê²½-ë³€ìˆ˜-ì„¤ì •)
- [ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜](#-ë°ì´í„°ë² ì´ìŠ¤-ë§ˆì´ê·¸ë ˆì´ì…˜)
- [ì£¼ìš” ê¸°ëŠ¥ ìƒì„¸](#-ì£¼ìš”-ê¸°ëŠ¥-ìƒì„¸)
- [API ì—”ë“œí¬ì¸íŠ¸](#-api-ì—”ë“œí¬ì¸íŠ¸)
- [í…ŒìŠ¤íŠ¸](#-í…ŒìŠ¤íŠ¸)
- [ê°œë°œ ê°€ì´ë“œ](#-ê°œë°œ-ê°€ì´ë“œ)

---

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### ğŸ”® AI ì‚¬ì£¼ ë¶„ì„
- **Google Gemini AI** ê¸°ë°˜ ì‹¤ì‹œê°„ ì‚¬ì£¼íŒ”ì ë¶„ì„
- êµ¬ë… í‹°ì–´ì— ë”°ë¥¸ AI ëª¨ë¸ ì°¨ë“± ì ìš©
  - **Free**: Gemini 2.5 Flash Lite (ë¹ ë¥¸ ë¶„ì„)
  - **Pro**: Gemini 2.5 Pro (ê³ ê¸‰ ì‹¬ì¸µ ë¶„ì„)
- ìƒë…„ì›”ì¼, ì¶œìƒì‹œê°„(ì„ íƒ), ì„±ë³„ ê¸°ë°˜ ê°œì¸í™” ë¶„ì„
- ì‚¬ì£¼íŒ”ì, ì˜¤í–‰ ë¶„ì„, ì„±ê²©, ê±´ê°•, ì¬ë¬¼, ì• ì •, ì§ì—… ë“± ì¢…í•© ìš´ì„¸ ì œê³µ

### ğŸ’³ êµ¬ë… ë° ê²°ì œ ì‹œìŠ¤í…œ
- **TossPayments ë¹Œë§í‚¤ ë°©ì‹** ì •ê¸°ê²°ì œ
- Free í‹°ì–´: 3íšŒ ë¬´ë£Œ ê²€ì‚¬
- Pro í‹°ì–´: ì›” 9,900ì›, ë§¤ì›” 10íšŒ ê²€ì‚¬
- êµ¬ë… í•´ì§€ ë° ì¬í™œì„±í™” ê¸°ëŠ¥
- ìë™ ì •ê¸°ê²°ì œ (ë§¤ì›” 1ì¼)
- ê²°ì œ ì‹¤íŒ¨ ì‹œ ìë™ êµ¬ë… ë§Œë£Œ ì²˜ë¦¬

### ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬
- **Clerk Authentication** ê¸°ë°˜ íšŒì› ì¸ì¦
- ì†Œì…œ ë¡œê·¸ì¸ ì§€ì›
- ì‚¬ìš©ìë³„ ê²€ì‚¬ ì´ë ¥ ê´€ë¦¬
- í”„ë¡œí•„ ì´ë¯¸ì§€ ë° ê°œì¸ì •ë³´ ê´€ë¦¬

### ğŸ“Š ëŒ€ì‹œë³´ë“œ
- ê²€ì‚¬ ì´ë ¥ ì¡°íšŒ ë° ê²€ìƒ‰
- ìƒì„¸ ë¶„ì„ ê²°ê³¼ ì—´ëŒ
- êµ¬ë… ì •ë³´ ë° ì”ì—¬ ê²€ì‚¬ íšŸìˆ˜ í™•ì¸
- ë‹¤ìŒ ê²°ì œì¼ ì•ˆë‚´

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### Frontend
- **Next.js 15** - React í”„ë ˆì„ì›Œí¬ (App Router)
- **React 19** - UI ë¼ì´ë¸ŒëŸ¬ë¦¬
- **TypeScript** - íƒ€ì… ì•ˆì „ì„±
- **Tailwind CSS** - ìœ í‹¸ë¦¬í‹° ìš°ì„  ìŠ¤íƒ€ì¼ë§
- **shadcn-ui** - ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸
- **React Query** - ì„œë²„ ìƒíƒœ ê´€ë¦¬
- **React Hook Form** - í¼ ê´€ë¦¬
- **Zod** - ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì‚¬

### Backend
- **Hono** - ê²½ëŸ‰ ì›¹ í”„ë ˆì„ì›Œí¬
- **Next.js Route Handler** - API ì—”ë“œí¬ì¸íŠ¸
- **Supabase** - PostgreSQL ë°ì´í„°ë² ì´ìŠ¤
- **Clerk** - ì¸ì¦ ë° ì‚¬ìš©ì ê´€ë¦¬

### ì™¸ë¶€ ì„œë¹„ìŠ¤
- **Google Gemini AI** - AI ì‚¬ì£¼ ë¶„ì„ ì—”ì§„
- **TossPayments** - ì •ê¸°ê²°ì œ ì²˜ë¦¬
- **Supabase pg_cron** - ì •ê¸° ì‘ì—… ìŠ¤ì¼€ì¤„ë§

### í…ŒìŠ¤íŠ¸
- **Vitest** - ë‹¨ìœ„ ë° í†µí•© í…ŒìŠ¤íŠ¸
- **Playwright** - E2E í…ŒìŠ¤íŠ¸
- **happy-dom** - í…ŒìŠ¤íŠ¸ í™˜ê²½

### ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬
- `date-fns` - ë‚ ì§œ ì²˜ë¦¬
- `ts-pattern` - íŒ¨í„´ ë§¤ì¹­
- `es-toolkit` - ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
- `zustand` - ê²½ëŸ‰ ìƒíƒœ ê´€ë¦¬
- `lucide-react` - ì•„ì´ì½˜
- `framer-motion` - ì• ë‹ˆë©”ì´ì…˜

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
VMC006/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (dashboard)/              # ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ ê·¸ë£¹
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/            # ê²€ì‚¬ ì´ë ¥ ë° ìƒˆ ê²€ì‚¬
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ new/              # ìƒˆ ê²€ì‚¬ í˜ì´ì§€
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ result/[testId]/  # ê²€ì‚¬ ê²°ê³¼ ìƒì„¸
â”‚   â”‚   â”‚   â””â”€â”€ subscription/         # êµ¬ë… ê´€ë¦¬
â”‚   â”‚   â”‚       â””â”€â”€ billing/          # ê²°ì œ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ [[...hono]]/          # Hono ì•± ì§„ì…ì 
â”‚   â”‚   â”‚   â””â”€â”€ webhooks/             # Clerk Webhook
â”‚   â”‚   â”œâ”€â”€ sign-in/                  # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ sign-up/                  # íšŒì›ê°€ì… í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ page.tsx                  # ëœë”© í˜ì´ì§€
â”‚   â”‚
â”‚   â”œâ”€â”€ backend/                      # ë°±ì—”ë“œ ê³µí†µ ë ˆì´ì–´
â”‚   â”‚   â”œâ”€â”€ config/                   # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ gemini/                   # Gemini AI í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ hono/                     # Hono ì•± ë° Context
â”‚   â”‚   â”œâ”€â”€ http/                     # HTTP ì‘ë‹µ í—¬í¼
â”‚   â”‚   â”œâ”€â”€ middleware/               # ê³µí†µ ë¯¸ë“¤ì›¨ì–´
â”‚   â”‚   â””â”€â”€ supabase/                 # Supabase í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                     # ê¸°ëŠ¥ë³„ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ auth/                     # ì‚¬ìš©ì ì¸ì¦
â”‚   â”‚   â”‚   â”œâ”€â”€ backend/              # API ë¼ìš°íŠ¸, ì„œë¹„ìŠ¤, ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/                # React Query í›…
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/                  # DTO ì¬ë…¸ì¶œ
â”‚   â”‚   â”‚   â””â”€â”€ server/               # ì„œë²„ ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ saju/                     # ì‚¬ì£¼ ë¶„ì„
â”‚   â”‚   â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts          # API ë¼ìš°íŠ¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.ts        # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts         # Zod ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ error.ts          # ì—ëŸ¬ ì½”ë“œ
â”‚   â”‚   â”‚   â”œâ”€â”€ components/           # UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/                # React Query í›…
â”‚   â”‚   â”‚   â””â”€â”€ lib/                  # DTO
â”‚   â”‚   â”œâ”€â”€ subscription/             # êµ¬ë… ê´€ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts          # êµ¬ë… API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.ts        # êµ¬ë… ë¡œì§
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ toss-service.ts   # TossPayments í†µí•©
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cronService.ts    # ì •ê¸°ê²°ì œ Cron
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ components/           # êµ¬ë… UI
â”‚   â”‚   â”‚   â””â”€â”€ hooks/                # êµ¬ë… í›…
â”‚   â”‚   â””â”€â”€ dashboard/                # ëŒ€ì‹œë³´ë“œ
â”‚   â”‚       â”œâ”€â”€ backend/
â”‚   â”‚       â””â”€â”€ hooks/
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                   # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ ui/                       # shadcn-ui ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ hooks/                        # ê³µí†µ í›…
â”‚   â”œâ”€â”€ lib/                          # ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ remote/                   # API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ supabase/                 # Supabase í—¬í¼
â”‚   â”‚   â””â”€â”€ utils/                    # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚   â”œâ”€â”€ constants/                    # ìƒìˆ˜
â”‚   â””â”€â”€ test/                         # í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ unit/                     # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ integration/              # í†µí•© í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ e2e/                      # E2E í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ mocks/                    # Mock ë°ì´í„°
â”‚       â””â”€â”€ helpers/                  # í…ŒìŠ¤íŠ¸ í—¬í¼
â”‚
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/                   # ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚       â”œâ”€â”€ 20250126000000_create_users_table.sql
â”‚       â”œâ”€â”€ 20250126000001_create_saju_tests_table.sql
â”‚       â”œâ”€â”€ 20250126000002_create_subscriptions_table.sql
â”‚       â”œâ”€â”€ 20250126000003_create_payments_table.sql
â”‚       â”œâ”€â”€ 20250126000004_create_triggers.sql
â”‚       â”œâ”€â”€ 20250126000005_create_subscription_functions.sql
â”‚       â””â”€â”€ 20250126000006_create_billing_cron.sql
â”‚
â”œâ”€â”€ public/                           # ì •ì  íŒŒì¼
â”œâ”€â”€ .env.example                      # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì œ
â”œâ”€â”€ CLAUDE.md                         # ê°œë°œ ê°€ì´ë“œë¼ì¸
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ vitest.config.ts
â””â”€â”€ playwright.config.ts
```

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- **Node.js** 20.x ì´ìƒ
- **npm** ë˜ëŠ” **yarn**
- **Supabase** í”„ë¡œì íŠ¸ (ë°ì´í„°ë² ì´ìŠ¤)
- **Clerk** ê³„ì • (ì¸ì¦)
- **TossPayments** ê³„ì • (ê²°ì œ)
- **Google AI Studio** API Key (Gemini)

### ì„¤ì¹˜

1. **ì €ì¥ì†Œ í´ë¡ **

```bash
git clone <repository-url>
cd VMC006
```

2. **ì˜ì¡´ì„± ì„¤ì¹˜**

```bash
npm install
```

3. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

`.env.example` íŒŒì¼ì„ `.env.local`ë¡œ ë³µì‚¬í•˜ê³  ê°’ì„ ì…ë ¥í•©ë‹ˆë‹¤.

```bash
cp .env.example .env.local
```

ìì„¸í•œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì€ [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#-í™˜ê²½-ë³€ìˆ˜-ì„¤ì •) ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.

4. **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜**

Supabase ëŒ€ì‹œë³´ë“œì—ì„œ `supabase/migrations` í´ë”ì˜ SQL íŒŒì¼ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

ìì„¸í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë°©ë²•ì€ [ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜](#-ë°ì´í„°ë² ì´ìŠ¤-ë§ˆì´ê·¸ë ˆì´ì…˜) ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”.

5. **ê°œë°œ ì„œë²„ ì‹¤í–‰**

```bash
npm run dev
```

ë¸Œë¼ìš°ì €ì—ì„œ [http://localhost:3000](http://localhost:3000)ì„ ì—´ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í™•ì¸í•©ë‹ˆë‹¤.

---

## ğŸ” í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env.local` íŒŒì¼ì— ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

### Clerk Authentication

[Clerk Dashboard](https://dashboard.clerk.com)ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  API í‚¤ë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.

```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxx
CLERK_SECRET_KEY=sk_test_xxxxxxxxxxxx
CLERK_WEBHOOK_SECRET=whsec_xxxxxxxxxxxx
NEXT_PUBLIC_CLERK_SIGN_IN_URL=https://your-app.accounts.dev/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=https://your-app.accounts.dev/sign-up
NEXT_PUBLIC_CLERK_USER_PROFILE_URL=https://your-app.accounts.dev/user
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/dashboard
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/dashboard
```

**Webhook ì„¤ì •**:
- Clerk Dashboard â†’ Webhooks â†’ Add Endpoint
- Endpoint URL: `https://your-domain.com/api/webhooks/clerk`
- Events: `user.created`, `user.updated`, `user.deleted`

### Supabase

[Supabase Dashboard](https://supabase.com/dashboard)ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  API í‚¤ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_URL=https://xxx.supabase.co
```

**ì£¼ì˜**: `SUPABASE_SERVICE_ROLE_KEY`ëŠ” ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.

### Google Gemini AI

[Google AI Studio](https://aistudio.google.com/app/apikey)ì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.

```env
GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### TossPayments

[TossPayments ê°œë°œìì„¼í„°](https://docs.tosspayments.com)ì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.

```env
TOSS_SECRET_KEY=test_sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxx
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**ì£¼ì˜**: í…ŒìŠ¤íŠ¸ í‚¤ë¡œ ì‹œì‘í•˜ê³ , í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ë¼ì´ë¸Œ í‚¤ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.

### Cron Secret

ì •ê¸°ê²°ì œ Cron Job ì¸ì¦ì„ ìœ„í•œ ì‹œí¬ë¦¿ í† í°ì…ë‹ˆë‹¤. ëœë¤ ë¬¸ìì—´ì„ ìƒì„±í•©ë‹ˆë‹¤.

```env
CRON_SECRET_TOKEN=your-random-secret-token-here
```

```bash
# ëœë¤ í† í° ìƒì„± ì˜ˆì‹œ
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

### Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

1. [Supabase Dashboard](https://supabase.com/dashboard) â†’ í”„ë¡œì íŠ¸ ì„ íƒ
2. **SQL Editor** ë©”ë‰´ë¡œ ì´ë™
3. `supabase/migrations` í´ë”ì˜ SQL íŒŒì¼ë“¤ì„ **ìˆœì„œëŒ€ë¡œ** ì‹¤í–‰

#### ì‹¤í–‰ ìˆœì„œ

```
1. 20250126000000_create_users_table.sql
2. 20250126000001_create_saju_tests_table.sql
3. 20250126000002_create_subscriptions_table.sql
4. 20250126000003_create_payments_table.sql
5. 20250126000004_create_triggers.sql
6. 20250126000005_create_subscription_functions.sql
7. 20250126000006_create_billing_cron.sql
```

### ì£¼ìš” í…Œì´ë¸” ì„¤ëª…

#### `users`
- Clerk ì‚¬ìš©ì ì •ë³´ì™€ ë™ê¸°í™”
- êµ¬ë… í‹°ì–´ ë° ì”ì—¬ ê²€ì‚¬ íšŸìˆ˜ ê´€ë¦¬

#### `saju_tests`
- ì‚¬ì£¼ ê²€ì‚¬ ì´ë ¥ ì €ì¥
- AI ë¶„ì„ ê²°ê³¼ (ìš”ì•½ ë° ì „ì²´ ê²°ê³¼)

#### `subscriptions`
- Pro êµ¬ë… ì •ë³´
- ë¹Œë§í‚¤ ë° ë‹¤ìŒ ê²°ì œì¼ ê´€ë¦¬

#### `payments`
- ëª¨ë“  ê²°ì œ ë‚´ì—­ ê¸°ë¡ (ì„±ê³µ/ì‹¤íŒ¨)

### Cron Jobs ì„¤ì •

ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„ ë‹¤ìŒ Cron Jobì´ ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤:

- **ì •ê¸°ê²°ì œ Cron**: ë§¤ì›” 1ì¼ 00:00 ì‹¤í–‰
- **êµ¬ë… ë§Œë£Œ Cron**: ë§¤ì¼ 00:00 ì‹¤í–‰

Cron Jobì´ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œí•˜ë ¤ë©´ `CRON_SECRET_TOKEN` í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ“– ì£¼ìš” ê¸°ëŠ¥ ìƒì„¸

### 1. ì‚¬ì£¼ ë¶„ì„ í”Œë¡œìš°

#### 1.1 ê²€ì‚¬ ì‹¤í–‰
1. ì‚¬ìš©ìê°€ ëŒ€ìƒì ì •ë³´ ì…ë ¥ (ì´ë¦„, ìƒë…„ì›”ì¼, ì¶œìƒì‹œê°„, ì„±ë³„)
2. ì”ì—¬ ê²€ì‚¬ íšŸìˆ˜ í™•ì¸ (`remaining_tests > 0`)
3. êµ¬ë… í‹°ì–´ì— ë”°ë¼ AI ëª¨ë¸ ì„ íƒ
   - Free: `gemini-2.5-flash-lite`
   - Pro: `gemini-2.5-pro`
4. ê²€ì‚¬ ë ˆì½”ë“œ ìƒì„± (`status: 'processing'`)
5. ì”ì—¬ íšŸìˆ˜ ì¦‰ì‹œ ì°¨ê° (ë™ì‹œì„± ì œì–´)
6. Google Gemini API í˜¸ì¶œ (30ì´ˆ íƒ€ì„ì•„ì›ƒ, 3íšŒ ì¬ì‹œë„)
7. AI ì‘ë‹µ íŒŒì‹± ë° ì €ì¥
   - `summary_result`: ëª¨ë‹¬ìš© ìš”ì•½ (200ì ì´ë‚´)
   - `full_result`: ì „ì²´ ë¶„ì„ ê²°ê³¼ (ë§ˆí¬ë‹¤ìš´)
8. ê²€ì‚¬ ìƒíƒœ ì—…ë°ì´íŠ¸ (`completed` ë˜ëŠ” `failed`)

#### 1.2 ì—ëŸ¬ ì²˜ë¦¬
- **ì”ì—¬ íšŸìˆ˜ ë¶€ì¡±**: `NO_TESTS_REMAINING` (403)
- **AI íƒ€ì„ì•„ì›ƒ**: `AI_TIMEOUT` (504) - íšŸìˆ˜ ë³µêµ¬ ì•ˆ í•¨
- **AI ìš”ì²­ ì œí•œ**: `AI_RATE_LIMIT` (429) - íšŸìˆ˜ ë³µêµ¬
- **AI ì„œë¹„ìŠ¤ ì˜¤ë¥˜**: `AI_SERVICE_ERROR` (500) - íšŸìˆ˜ ë³µêµ¬

### 2. êµ¬ë… ê´€ë¦¬ í”Œë¡œìš°

#### 2.1 Pro êµ¬ë… ì‹œì‘
1. ì‚¬ìš©ìê°€ "Pro ì—…ê·¸ë ˆì´ë“œ" ë²„íŠ¼ í´ë¦­
2. `customerKey` ìƒì„± (UUID)
3. TossPayments ë¹Œë§ ìœ„ì ¯ ë Œë”ë§
4. ì‚¬ìš©ìê°€ ì¹´ë“œ ì •ë³´ ì…ë ¥
5. TossPaymentsì—ì„œ `authKey` ë°œê¸‰
6. ë°±ì—”ë“œë¡œ `authKey` ì „ì†¡
7. TossPayments APIë¡œ ë¹Œë§í‚¤ ë°œê¸‰
8. Supabase íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰:
   - `subscriptions` í…Œì´ë¸”ì— êµ¬ë… ìƒì„±
   - `users` í…Œì´ë¸” ì—…ë°ì´íŠ¸
     - `subscription_tier = 'pro'`
     - `remaining_tests = 10`
     - `next_billing_date = í˜„ì¬ì¼ + 1ê°œì›”`
9. êµ¬ë… í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜

#### 2.2 ì •ê¸°ê²°ì œ ì²˜ë¦¬
- **ì‹¤í–‰ ì£¼ê¸°**: ë§¤ì›” 1ì¼ 00:00 (Supabase pg_cron)
- **ì²˜ë¦¬ ë¡œì§**:
  1. `next_billing_date = ì˜¤ëŠ˜`ì´ê³  `status = 'active'`ì¸ êµ¬ë… ì¡°íšŒ
  2. ê° êµ¬ë…ì— ëŒ€í•´ ë¹Œë§í‚¤ë¡œ ê²°ì œ ìŠ¹ì¸ (9,900ì›)
  3. **ì„±ê³µ ì‹œ**:
     - `next_billing_date` 1ê°œì›” ì—°ì¥
     - `remaining_tests = 10` ì¶©ì „
     - `payments` í…Œì´ë¸”ì— ì„±ê³µ ê¸°ë¡ ì €ì¥
  4. **ì‹¤íŒ¨ ì‹œ**:
     - êµ¬ë… ìƒíƒœë¥¼ `expired`ë¡œ ë³€ê²½
     - `subscription_tier = 'free'`ë¡œ ì „í™˜
     - `payments` í…Œì´ë¸”ì— ì‹¤íŒ¨ ê¸°ë¡ ì €ì¥

#### 2.3 êµ¬ë… í•´ì§€
1. ì‚¬ìš©ìê°€ "êµ¬ë… í•´ì§€" ë²„íŠ¼ í´ë¦­
2. í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
3. êµ¬ë… ìƒíƒœë¥¼ `cancelled`ë¡œ ë³€ê²½
4. `billing_key` ë° `customer_key`ë¥¼ NULLë¡œ ì„¤ì •
5. `next_billing_date`ê¹Œì§€ Pro í˜œíƒ ìœ ì§€
6. ë‹¤ìŒ ê²°ì œì¼ ì´í›„ ìë™ìœ¼ë¡œ Free í‹°ì–´ë¡œ ì „í™˜

#### 2.4 êµ¬ë… ì¬í™œì„±í™”
- **ì¡°ê±´**: ë¹Œë§í‚¤ê°€ ë‚¨ì•„ìˆëŠ” ê²½ìš°ë§Œ ê°€ëŠ¥
- **ì œì•½**: í•´ì§€ í›„ ë¹Œë§í‚¤ê°€ ì‚­ì œë˜ë©´ ì¬í™œì„±í™” ë¶ˆê°€ (ìƒˆë¡œ êµ¬ë…í•´ì•¼ í•¨)

---

## ğŸŒ API ì—”ë“œí¬ì¸íŠ¸

ëª¨ë“  APIëŠ” `/api` ê²½ë¡œ ì•„ë˜ì— ìˆìœ¼ë©°, Clerk ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

### ì¸ì¦ (Auth)

#### `GET /api/user/me`
í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

**ì‘ë‹µ**:
```json
{
  "id": "user_xxx",
  "email": "user@example.com",
  "name": "í™ê¸¸ë™",
  "profileImageUrl": "https://...",
  "subscriptionTier": "free",
  "remainingTests": 3,
  "createdAt": "2025-01-26T00:00:00Z",
  "updatedAt": "2025-01-26T00:00:00Z"
}
```

---

### ì‚¬ì£¼ ë¶„ì„ (Saju)

#### `POST /api/saju/analyze`
ìƒˆ ì‚¬ì£¼ ê²€ì‚¬ ì‹¤í–‰

**ìš”ì²­ ë°”ë””**:
```json
{
  "testName": "í™ê¸¸ë™",
  "birthDate": "1990-01-01",
  "birthTime": "14:30",
  "isBirthTimeUnknown": false,
  "gender": "male"
}
```

**ì‘ë‹µ**:
```json
{
  "testId": "550e8400-e29b-41d4-a716-446655440000",
  "summaryResult": "ê·€í•˜ì˜ ì‚¬ì£¼ëŠ”...",
  "status": "completed"
}
```

#### `GET /api/saju/tests/:testId`
ê²€ì‚¬ ê²°ê³¼ ìƒì„¸ ì¡°íšŒ

**ì‘ë‹µ**:
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "testName": "í™ê¸¸ë™",
  "birthDate": "1990-01-01",
  "birthTime": "14:30:00",
  "gender": "male",
  "status": "completed",
  "aiModel": "gemini-2.5-pro",
  "summaryResult": "ê·€í•˜ì˜ ì‚¬ì£¼ëŠ”...",
  "fullResult": "# ì‚¬ì£¼íŒ”ì ë¶„ì„ ê²°ê³¼\n\n...",
  "createdAt": "2025-01-26T00:00:00Z",
  "completedAt": "2025-01-26T00:00:30Z"
}
```

#### `GET /api/saju/tests`
ê²€ì‚¬ ì´ë ¥ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)

**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°**:
- `page` (optional): í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ê°’: 1)
- `limit` (optional): í˜ì´ì§€ í¬ê¸° (ê¸°ë³¸ê°’: 10)
- `search` (optional): ì´ë¦„ ê²€ìƒ‰

**ì‘ë‹µ**:
```json
{
  "tests": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "testName": "í™ê¸¸ë™",
      "birthDate": "1990-01-01",
      "status": "completed",
      "createdAt": "2025-01-26T00:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "totalCount": 25,
    "totalPages": 3
  }
}
```

---

### êµ¬ë… (Subscription)

#### `GET /api/subscription`
êµ¬ë… ì •ë³´ ì¡°íšŒ

**ì‘ë‹µ**:
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "user_xxx",
  "status": "active",
  "cardCompany": "ì‹ í•œ",
  "cardNumber": "1234",
  "nextBillingDate": "2025-02-01",
  "createdAt": "2025-01-01T00:00:00Z"
}
```

#### `POST /api/subscription/billing/confirm`
ë¹Œë§í‚¤ ë°œê¸‰ ë° êµ¬ë… ìƒì„±

**ìš”ì²­ ë°”ë””**:
```json
{
  "authKey": "auth_key_from_toss",
  "customerKey": "customer_xxx"
}
```

**ì‘ë‹µ**:
```json
{
  "subscriptionId": "550e8400-e29b-41d4-a716-446655440000",
  "status": "active",
  "nextBillingDate": "2025-02-01"
}
```

#### `POST /api/subscription/cancel`
êµ¬ë… í•´ì§€

**ì‘ë‹µ**:
```json
{
  "message": "êµ¬ë…ì´ í•´ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "expiresAt": "2025-02-01"
}
```

#### `POST /api/subscription/reactivate`
êµ¬ë… ì¬í™œì„±í™”

**ì‘ë‹µ**:
```json
{
  "message": "êµ¬ë…ì´ ì¬í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "nextBillingDate": "2025-02-01"
}
```

---

### ëŒ€ì‹œë³´ë“œ (Dashboard)

#### `GET /api/user/subscription`
ì‚¬ìš©ì êµ¬ë… ì •ë³´ ìš”ì•½

**ì‘ë‹µ**:
```json
{
  "subscriptionTier": "pro",
  "remainingTests": 7,
  "nextBillingDate": "2025-02-01"
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

Vitestë¥¼ ì‚¬ìš©í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test

# Watch ëª¨ë“œ
npm run test:watch

# UI ëª¨ë“œ
npm run test:ui

# ì»¤ë²„ë¦¬ì§€
npm run test:coverage
```

**í…ŒìŠ¤íŠ¸ íŒŒì¼ ìœ„ì¹˜**: `src/test/unit/`

### í†µí•© í…ŒìŠ¤íŠ¸

Hono ë¼ìš°í„° + ë¯¸ë“¤ì›¨ì–´ í†µí•© í…ŒìŠ¤íŠ¸

```bash
npm run test
```

**í…ŒìŠ¤íŠ¸ íŒŒì¼ ìœ„ì¹˜**: `src/test/integration/`

### E2E í…ŒìŠ¤íŠ¸

Playwrightë¥¼ ì‚¬ìš©í•œ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

```bash
# E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test:e2e

# UI ëª¨ë“œ
npm run test:e2e:ui

# í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ
npm run test:e2e -- --headed
```

**í…ŒìŠ¤íŠ¸ íŒŒì¼ ìœ„ì¹˜**: `src/test/e2e/`

**ì£¼ìš” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
- ì‚¬ìš©ì ì¸ì¦ í”Œë¡œìš°
- ì‚¬ì£¼ ë¶„ì„ ì‹¤í–‰ ë° ê²°ê³¼ ì¡°íšŒ
- êµ¬ë… ì‹œì‘ ë° í•´ì§€
- ëŒ€ì‹œë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜

---

## ğŸ—ï¸ ê°œë°œ ê°€ì´ë“œ

### ì½”ë“œ ìŠ¤íƒ€ì¼

- **í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°**: Immutable ë°ì´í„°, Pure Functions ìš°ì„ 
- **Early Return**: ì¡°ê¸° ë°˜í™˜ìœ¼ë¡œ ì¤‘ì²© ìµœì†Œí™”
- **íƒ€ì… ì•ˆì „ì„±**: TypeScript strict ëª¨ë“œ, Zod ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì‚¬
- **ëª…í™•í•œ ë„¤ì´ë°**: ì¶•ì•½ì–´ ì§€ì–‘, ì˜ë„ê°€ ëª…í™•í•œ ë³€ìˆ˜/í•¨ìˆ˜ëª…

### ìƒˆ ê¸°ëŠ¥ ì¶”ê°€

`src/features/[featureName]` ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ë”°ë¼ ê°œë°œí•©ë‹ˆë‹¤.

```
src/features/[featureName]/
  â”œâ”€â”€ backend/
  â”‚   â”œâ”€â”€ route.ts       # Hono ë¼ìš°í„°
  â”‚   â”œâ”€â”€ service.ts     # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
  â”‚   â”œâ”€â”€ schema.ts      # Zod ìŠ¤í‚¤ë§ˆ
  â”‚   â””â”€â”€ error.ts       # ì—ëŸ¬ ì½”ë“œ
  â”œâ”€â”€ components/        # React ì»´í¬ë„ŒíŠ¸
  â”œâ”€â”€ hooks/             # React Query í›…
  â”œâ”€â”€ lib/               # DTO ì¬ë…¸ì¶œ
  â””â”€â”€ constants/         # ìƒìˆ˜
```

### shadcn-ui ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

```bash
npx shadcn@latest add dialog
npx shadcn@latest add card
npx shadcn@latest add button
```

### ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ê°€

1. `supabase/migrations` í´ë”ì— ìƒˆ SQL íŒŒì¼ ìƒì„±
   ```
   supabase/migrations/YYYYMMDDHHMMSS_description.sql
   ```

2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì„± (Idempotentí•˜ê²Œ)
   ```sql
   CREATE TABLE IF NOT EXISTS my_table (
     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
     created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );
   ```

3. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ì‹¤í–‰

### ì—ëŸ¬ ì²˜ë¦¬

ê° ê¸°ëŠ¥ì˜ `error.ts` íŒŒì¼ì— ì—ëŸ¬ ì½”ë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

```typescript
export const myFeatureErrorCodes = {
  NOT_FOUND: 'NOT_FOUND',
  INVALID_INPUT: 'INVALID_INPUT',
} as const;

export type MyFeatureErrorCode = typeof myFeatureErrorCodes[keyof typeof myFeatureErrorCodes];
```

ì„œë¹„ìŠ¤ì—ì„œ ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

```typescript
import { failure } from '@/backend/http/response';
import { myFeatureErrorCodes } from './error';

export function myService() {
  return failure(404, myFeatureErrorCodes.NOT_FOUND, 'Resource not found');
}
```

---

## ğŸ“ ì£¼ìš” íŒ¨í‚¤ì§€ ìŠ¤í¬ë¦½íŠ¸

```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev

# í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run build

# í”„ë¡œë•ì…˜ ì„œë²„ ì‹¤í–‰
npm run start

# ë¦°íŒ…
npm run lint

# íƒ€ì… ì²´í¬
npm run type-check

# í…ŒìŠ¤íŠ¸
npm run test              # ë‹¨ìœ„ + í†µí•© í…ŒìŠ¤íŠ¸
npm run test:ui           # í…ŒìŠ¤íŠ¸ UI
npm run test:run          # CI ëª¨ë“œ
npm run test:e2e          # E2E í…ŒìŠ¤íŠ¸
npm run test:e2e:ui       # Playwright UI
```

---

## ğŸŒŸ ì£¼ìš” ê°œì„  ì œì•ˆ

í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ê°€ ì™„ë£Œëœ ìƒíƒœì´ë©°, ë‹¤ìŒê³¼ ê°™ì€ ê°œì„  ì‚¬í•­ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **ë¡œê¹… ê°•í™”**: Console Logger â†’ Sentry/Datadog ì—°ë™
2. **ìºì‹± ì „ëµ**: React Query ìºì‹œ ì‹œê°„ ìµœì í™”
3. **ëª¨ë‹ˆí„°ë§**: APM ë„êµ¬ ì—°ë™ (New Relic, Sentry)
4. **ì´ë¯¸ì§€ ìµœì í™”**: Next.js Image ì»´í¬ë„ŒíŠ¸ í™œìš©
5. **ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…**: Dynamic Importë¡œ ë²ˆë“¤ í¬ê¸° ìµœì í™”
6. **API ë¬¸ì„œí™”**: Swagger/OpenAPI ìë™ ìƒì„±

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” ë¹„ê³µê°œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

---

## ğŸ¤ ê¸°ì—¬

ì´ í”„ë¡œì íŠ¸ëŠ” í˜„ì¬ ë¹„ê³µê°œ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.

---

## ğŸ“ ë¬¸ì˜

í”„ë¡œì íŠ¸ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ê°œë°œíŒ€ì— ì—°ë½í•´ì£¼ì„¸ìš”.

---

**Built with â¤ï¸ using Next.js, Hono, and Google Gemini AI**
