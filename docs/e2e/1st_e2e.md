## YC 스타트업 CTO 보고: 테스트 환경 구축 계획

### 1. 간략한 개요 (상급자 보고용)

MVP 프로젝트의 안정성을 확보하고, 신속한 개발 주기(Iteration)를 지원하기 위한 최소 비용/최대 효율의 테스트 환경 구축 계획을 보고합니다.

| 구분 | 기술 스택 | 목적 | 투자/효율성 관점 |
| :--- | :--- | :--- | :--- |
| **단위 테스트** | **Vitest** + **@testing-library/react** | 컴포넌트, React-Query Hooks, Hono 백엔드 Service 로직의 기능 및 비즈니스 로직 검증. | **신속성/간결함**: Jest 대비 빠른 실행 속도, 간편한 설정, 통합적인 사용성. |
| **E2E 테스트** | **Playwright** | 실제 브라우저 환경에서 Clerk 인증, Next.js 라우팅, API 통합을 포함한 핵심 사용자 시나리오(Critical Path) 검증. | **안정성/확장성**: 멀티 브라우저 지원, 실제 유저 경험을 모사하여 내부 베타테스트 품질 확보. |
| **Mocking** | **Vitest Mocking API** / **Supabase Client Mocking** | 오버엔지니어링을 피하고, 단위 테스트 범위 내에서 의존성(DB, 외부 API)을 격리. | **오버엔지니어링 회피**: 당장 MSW와 같은 복잡한 도구는 제외, 필요한 부분만 간결하게 모킹. |

**결론:** 선정된 기술 스택은 MVP의 핵심 가치인 '신속함', '간결함', '확장성'을 동시에 충족하며, 안정적인 내부 베타테스트를 위한 기반을 다질 것입니다.

---

### 2. 도출된 결론의 장점, 예상되는 한계점

#### 장점 (Pros)

| 구분 | 내용 |
| :--- | :--- |
| **개발 속도 최적화** | **Vitest**는 빠른 모듈 번들러(Vite) 기반으로, 테스트 실행 속도가 매우 빠르므로, 개발자의 TDD 및 빠른 피드백 주기(Iteration)를 강력하게 지원합니다. |
| **간결하고 통합적인 스택** | 단일 테스트 러너(Vitest)로 프론트엔드 (React, Hooks)와 백엔드 (Hono Service Layer) 코드를 모두 테스트할 수 있어 관리 포인트가 줄어듭니다. |
| **실제 사용자 흐름 보장** | **Playwright**를 통해 Clerk 로그인, React-Query 데이터 흐름, Next.js의 클라이언트/서버 컴포넌트 통합을 실제 브라우저에서 검증할 수 있어 배포의 안정성이 높습니다. |
| **쉬운 인프라 지향** | DB Mocking을 통해 개발/테스트 환경 분리 비용을 최소화하여 인프라 복잡도를 낮춥니다. |

#### 예상되는 한계점 (Cons)

| 구분 | 내용 |
| :--- | :--- |
| **Next.js 특수 기능 모킹** | App Router의 Server Component (RSC)나 `next/navigation`의 일부 복잡한 기능을 모킹하는 과정에서 예상치 못한 어려움이 발생할 수 있습니다. |
| **Hono/Middleware 통합 테스트의 제한** | Vitest에서 Hono의 미들웨어 체인(`withAppContext`, `withSupabase`, `requireAuth`) 전체를 테스트하려면 실제 Hono 환경과 유사하게 구성하는 추가적인 설정이 필요합니다. 이는 단위 테스트의 범위를 넘어설 수 있습니다. |
| **E2E 테스트의 초기 설정 복잡도** | Playwright에서 Clerk 인증 상태를 유지하기 위한 `storageState` 설정과 테스트 실행 전/후 DB 초기화(Seed/Clean) 스크립트 구축에 초기 시간이 소요될 수 있습니다. |

---

### 3. 자세한 내용 및 구현 계획

#### A. 사용할 기술 스택 및 라이브러리

| 영역 | 라이브러리/도구 | 버전 | 결정 이유 |
| :--- | :--- | :--- | :--- |
| **단위/통합 테스트 러너** | **Vitest** | `~1.x` | **신속함/간결함:** Jest와 유사한 문법을 제공하면서도 빠른 피드백 속도. 단일 도구로 Frontend/Backend 테스트를 통합하기 가장 용이함. |
| **React 컴포넌트 테스트** | **@testing-library/react** | `~14.x` | **표준/확장성:** React 커뮤니티의 표준 컴포넌트 테스트 라이브러리. 사용자 관점에서 UI 상호작용을 테스트하여 견고한 UI를 보장. |
| **E2E 테스트** | **Playwright** | `~1.x` | **안정성/확장성:** Next.js 기반 애플리케이션의 복잡한 비동기 로딩, 라우팅, Clerk 인증을 실제 브라우저에서 가장 안정적으로 테스트할 수 있음. |

#### B. 구현 계획 (결정 이유 포함)

| 단계 | 목표 | 결정된 방법 | 상세 결정 이유 |
| :--- | :--- | :--- | :--- |
| **FE 단위 테스트** | React Component, React Query Hooks 테스트 | **Vitest** + **@testing-library/react** 환경 설정. `src/hooks/use-toast.ts` 등 프레젠테이션 로직 테스트. | `useSajuAnalysis.ts`와 같은 커스텀 훅은 실제 API 호출을 모킹하고 캐싱 로직만 테스트하여 UI-로직 분리 테스트 용이. |
| **BE 단위 테스트** | Hono Service Layer (DB 비즈니스 로직) 테스트 | **Supabase Client 모킹**. `src/features/*/backend/service.ts` 파일에서 사용하는 `SupabaseClient` 인스턴스를 `vi.mock`으로 대체. | **간결함/오버엔지니어링 회피:** 실제 DB 연결 없이 비즈니스 로직(데이터 변환, 권한 확인, 에러 처리)만 빠르게 검증 가능. 불필요한 테스트 DB 구축 비용 절감. |
| **API 통합 테스트** | Hono Router (미들웨어 포함) 테스트 | **Hono Test Client** 사용. `src/backend/hono/app.ts`에서 앱 인스턴스를 가져와서, 실제 HTTP 요청 대신 인메모리 요청/응답 테스트. (미들웨어 내부 Supabase는 Mocking 필요) | Hono가 제공하는 간결한 테스트 API를 활용하여 라우팅 및 미들웨어 통합까지 검증. `route.ts`에 가까운 레이어 테스트 가능. |
| **E2E 테스트** | 사주 검사 및 구독 플로우의 전체 검증 | **Playwright** 사용. 테스트 전용 계정을 미리 생성하고, `storageState`를 통해 로그인 세션을 재사용. | **신속함/안정성:** 매번 로그인하는 비효율을 제거. Clerk 인증 화면의 로딩 및 리다이렉션을 안정적으로 처리하고 핵심 기능에 집중할 수 있음. |

#### C. 간단한 예시 테스트

상기 "4. 자세한 내용" 섹션의 **1. 단위 테스트 예시**와 **2. E2E 테스트 예시**를 통해 `src/features/auth/backend/service.ts`의 DB 로직과 주요 사용자 시나리오의 작동을 검증할 수 있습니다.

---

### 4. AI 피드백 프롬프트

```prompt
## AI 평가자의 역할 및 임무: MVP CTO의 대리인

당신의 임무는 YC 배치에 선정된 스타트업의 CTO가 작성한 '단위/E2E 테스트 환경 구축 계획'을 평가하는 것입니다. 당신의 평가 기준은 다음과 같습니다.

### 핵심 평가 기준 (CTO의 핵심 가치 반영)
1. **신속한 개발 Iteration & 간결함:** 제안된 기술 스택과 계획이 환경 설정에 과도한 시간을 소모하지 않고, 개발팀이 빠르게 테스트 코드를 작성하고 실행할 수 있을 만큼 간결한가? (오버엔지니어링 회피)
2. **확장성 (장기적 관점):** 선정된 스택(Vitest, Playwright)이 향후 프로젝트 규모가 커지거나, API 및 UI가 복잡해졌을 때 확장 가능한 구조를 제공하는가? 특히 Next.js/Hono/Supabase 스택의 통합 테스트에 효율적인가?
3. **위험 요소 식별:** MVP 프로젝트를 오류 없이 완성하여 내부 베타테스트를 진행하는 목표를 저해할 수 있는 잠재적인 위험 요소(예: 복잡한 모킹, 느린 E2E 환경 구축, Next.js 특수 기능 통합의 어려움)가 있는가?

### 평가 요청 사항

다음 질문에 대해 상세하게 답변하세요.

1.  **기술 스택 적절성 평가:**
    *   Vitest, Playwright의 조합은 Next.js/Hono/React-Query 기반의 Full-Stack 애플리케이션에 대해 "신속함"과 "확장성"이라는 핵심 가치에 비추어 적절한 선택인가요?
    *   API Backend (Hono + Supabase Service) 테스트를 위한 Vitest의 활용 전략(Supabase Client 모킹)은 간결하고 실용적인가요? 특히 `src/features/saju/backend/service.ts`의 `analyzeSaju` 함수는 DB 조회/삽입/업데이트, 횟수 차감/복구, Gemini API 호출 등 복잡한 로직을 포함하고 있는데, 이 함수를 효과적으로 테스트하기 위한 Mocking 전략에 개선할 점이 있나요?
2.  **구현 계획의 위험 요소 분석:**
    *   E2E 테스트에서 **Clerk 인증**과 **React-Query 캐싱**을 처리하는 방식(`storageState` 및 `beforeEach` 사용)이 견고한지 평가하고, Playwright 환경에서 Mocking 없이 실제 API 서버를 사용하는 방식의 장/단점을 논하세요.
    *   단위 테스트 예시(Service Layer)에서처럼, 실제 DB 대신 Mocking된 Supabase 클라이언트를 주입하는 방식이 충분한 테스트 커버리지를 제공할 수 있는지 의견을 제시해 주세요. 이 방식이 DB 스키마 변경에 얼마나 취약한가요?
3.  **개선/최적화 제안:** MVP 목표 달성(오류 없이 완성)을 위해, 제안된 계획에서 가장 먼저 간소화하거나(오버엔지니어링 회피) 보강해야 할 부분은 무엇인가요? (예: MSW 도입 시점, E2E Mocking 도입 시점 등)
```