# PRD: 사주 풀이 웹앱

## 제품 개요

**목적**: 사용자의 생년월일시 정보를 입력받아 AI 기반 사주 분석 결과를 제공하는 구독형 웹 서비스

**핵심 가치**:
- AI(Gemini) 기반 즉시 사주 분석
- 검사 이력 관리 및 재조회
- 구독 기반 프리미엄 분석 제공

**기술 스택**:
- 인증: Clerk SDK
- 데이터베이스: Supabase PostgreSQL (RLS 미사용)
- 결제: 토스 페이먼츠
- AI 분석: Gemini API (flash/pro)
- 정기결제: Supabase cron → Hono API

## 포함 페이지

### 1. 메인 (`/`)
- 서비스 소개, 시작하기 CTA

### 2. 로그인/회원가입 (`/sign-in`, `/sign-up`)
- Clerk 기본 UI 사용

### 3. 대시보드 (`/dashboard`)
- 검사 이력 조회 및 검색
- 사이드바: 홈, 새검사, 사용자 정보(잔여 횟수, 요금제)

### 4. 새 검사 (`/dashboard/new`)
- 입력: 이름, 생년월일(캘린더), 출생시간(시간 선택기), 성별
- 출생시간 모름 옵션
- 검사 시작 → 로딩 → 결과 모달

### 5. 분석 모달
- Gemini 요약 결과 표시
- 상세 보기 CTA

### 6. 분석 상세 (`/dashboard/result/[id]`)
- 전체 분석 결과 표시

### 7. 구독 관리 (`/dashboard/subscription`)
- 현재 구독 정보 (요금제, 잔여 횟수)
- Pro 업그레이드 박스
- 구독 해지 버튼

### 8. 토스 페이먼츠 연동
- 카드 등록 페이지 (SDK 제공 UI)
- 테스트 모드 경고 표시

## 사용자 여정

### Segment 1: 신규 무료 사용자
1. **메인** → 시작하기 클릭
2. **회원가입** → Clerk로 가입
3. **대시보드** → 빈 상태, 새검사 버튼
4. **새 검사** → 정보 입력 후 검사 (flash 모델, 잔여 3→2회)
5. **분석 모달** → 요약 확인
6. **분석 상세** → 전체 결과 확인
7. **대시보드** → 이력에 검사 저장됨

### Segment 2: 무료 사용자 (3회 소진)
1. **대시보드** → 사이드바에서 잔여 0회 확인
2. **새 검사** → 검사 시도 시 "잔여 횟수 없음" 오류
3. **구독 관리** → Pro 업그레이드 박스 확인
4. **토스 페이먼츠** → 카드 등록 및 결제
5. **구독 관리** → Pro 요금제, 월 10회로 업데이트
6. **새 검사** → pro 모델로 검사 가능

### Segment 3: Pro 구독자
1. **로그인** → 대시보드
2. **대시보드** → 사이드바에서 "Pro, 잔여 7/10회" 확인
3. **새 검사** → pro 모델로 즉시 검사 (잔여 7→6회)
4. **대시보드** → 검색으로 과거 이력 조회
5. **분석 상세** → 과거 검사 재확인

### Segment 4: 구독 해지 사용자
1. **구독 관리** → 구독 해지 클릭
2. **시스템** → 빌링키 삭제, 다음 결제일까지 Pro 유지
3. **다음 결제일** → 무료 요금제로 전환 (월 0회)

## IA (Information Architecture)

```
[레이아웃]
├─ 헤더 (모든 페이지 공통)
│  ├─ 로고 (클릭 → 메인)
│  └─ 로그인/계정 버튼
│
└─ 푸터 (모든 페이지 공통)
   └─ 회사 정보 (사업자 정보, 이용약관, 개인정보처리방침)

[페이지]
Root (/)
│
├─ / (메인)
│  └─ 시작하기 → /dashboard or /sign-in
│
├─ /sign-in (로그인)
│  └─ Clerk UI
│
├─ /sign-up (회원가입)
│  └─ Clerk UI
│
└─ /dashboard (대시보드) [인증 필요]
   │
   ├─ 사이드바 (dashboard 하위 공통)
   │  ├─ 홈 버튼
   │  ├─ 새검사 버튼
   │  └─ 하단: 아이디, 잔여 횟수, 요금제 (클릭 → subscription)
   │
   ├─ /dashboard (홈)
   │  ├─ 검사 이력 목록
   │  └─ 검색 기능
   │
   ├─ /dashboard/new (새 검사)
   │  ├─ 입력 폼
   │  └─ 분석 모달 (팝업)
   │
   ├─ /dashboard/result/[id] (분석 상세)
   │  └─ 전체 분석 결과
   │
   └─ /dashboard/subscription (구독 관리)
      ├─ 현재 구독 정보
      ├─ Pro 업그레이드 박스
      └─ 구독 해지 버튼
         └─ → /payment (토스 페이먼츠)

[API]
/api (Hono 백엔드)
├─ /api/saju/analyze (POST) - Gemini 분석
├─ /api/subscription/billing (POST) - cron 정기결제
└─ /api/payment/* - 토스 페이먼츠 webhook
```

## 구독 정책

| 항목 | 무료 | Pro |
|------|------|-----|
| 월 검사 횟수 | 가입 시 3회 | 10회 |
| 사용 모델 | gemini-2.5-flash | gemini-2.5-pro |
| 결제 | - | 정기 결제 |
| 해지 | - | 다음 결제일까지 유지 |

**정기결제 플로우**:
1. Supabase cron (매일 02:00) → Hono API 호출
2. 검증 후 오늘이 결제일인 구독 탐색
3. 결제 성공: 횟수 초기화(10회) + 기간 연장
4. 결제 실패: 즉시 구독 해지